<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>JW Player 广告测试</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: #000;
      height: 100%;
    }
    #myElement {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="myElement">Loading player...</div>

  <!-- 使用 Dashboard 提供的 JW Player 库 -->
  <script src="https://cdn.jwplayer.com/libraries/m19ahv3T.js"></script>

  <script>
    // ===拦截 XMLHttpRequest===
    (function() {
      const origOpen = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url) {
        this._url = url;
        return origOpen.apply(this, arguments);
      };
      const origSend = XMLHttpRequest.prototype.send;
      XMLHttpRequest.prototype.send = function() {
        const xhr = this;
        const origOnReady = xhr.onreadystatechange;
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            console.log("[XHR]", xhr._url, xhr.status);
          }
          if (origOnReady) {
            origOnReady.apply(xhr, arguments);
          }
        };
        return origSend.apply(this, arguments);
      };
    })();

    // ===拦截 fetch===
    (function() {
      const origFetch = window.fetch;
      window.fetch = function() {
        return origFetch.apply(this, arguments).then(res => {
          console.log("[FETCH]", res.url, res.status);
          return res;
        });
      };
    })();

    const player = jwplayer("myElement").setup({
      file: "https://siloh.pluto.tv/lilo/production/SkyNews/master.m3u8", // ⚠️ 改成你的 HLS 直播流地址
      image: "",
      width: "100%",
      aspectratio: "16:9",
      autostart: false,
      controls: true,
      advertising: {
        client: "vast",
        scheduleid: "75b47OiQ"
      }
    });

    // 捕捉常见错误
    player.on('error', function(event) {
      console.error("JW Player 播放错误：", event);
      alert("JW Player 播放错误： " + JSON.stringify(event));
    });

    // 捕捉广告错误
    player.on('adError', function(event) {
      console.error("广告错误：", event);
      alert("广告错误： " + JSON.stringify(event));
    });

    // 捕捉加载失败（setup）
    player.on('setupError', function(event) {
      console.error("播放器配置错误：", event);
      alert("播放器配置错误： " + JSON.stringify(event));
    });

    // 警告信息
    player.on('warning', function(event) {
      console.warn("JW Player 警告：", event);
    });
  </script>
</body>
</html>

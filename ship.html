<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>JW Player 广告测试</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: #000;
      height: 100%;
    }

    /* 播放器固定宽高，居中 */
    #myElement {
      width: 640px;
      height: 360px;
      margin: 40px auto; /* 上下留白，水平居中 */
      background: #000;
    }

    /* 永远显示控制栏 */
    .jwplayer .jw-controls {
      opacity: 1 !important;
      visibility: visible !important;
      display: flex !important;
      transition: none !important;
      pointer-events: auto !important;
    }
    .jwplayer.jw-flag-user-inactive .jw-controls {
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
    }
  </style>
</head>
<body>
  <div id="myElement">Loading player...</div>
<div id="companionSlot" style="width:300px;height:60px;"></div>
  <!-- 引入 JW Player 脚本 -->
  <script src="https://cdn.jwplayer.com/libraries/m19ahv3T.js"></script>

  <script>
    // ===拦截 XMLHttpRequest===
    (function() {
      const origOpen = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url) {
        this._url = url;
        return origOpen.apply(this, arguments);
      };
      const origSend = XMLHttpRequest.prototype.send;
      XMLHttpRequest.prototype.send = function() {
        const xhr = this;
        const origOnReady = xhr.onreadystatechange;
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            console.log("[XHR]", xhr._url, xhr.status);
          }
          if (origOnReady) {
            origOnReady.apply(xhr, arguments);
          }
        };
        return origSend.apply(this, arguments);
      };
    })();

    // ===拦截 fetch===
    (function() {
      const origFetch = window.fetch;
      window.fetch = function() {
        return origFetch.apply(this, arguments).then(res => {
          console.log("[FETCH]", res.url, res.status);
          return res;
        });
      };
    })();

    // === 初始化播放器（固定宽高）===
    const player = jwplayer("myElement").setup({
      file: "https://live-hls-web-aje.getaj.net/AJE/01.m3u8",
      width: 640,
      height: 360,
      autostart: false,
      controls: true,
      advertising: {
        client: "vast",
        scheduleid: "75b47OiQ",
        companions: true

      }
    });

    // === 强制控制栏一直显示 ===
    player.on('ready', function() {
      const container = document.getElementById('myElement');
      setInterval(() => {
        container.classList.remove('jw-flag-user-inactive');
      }, 1000);
    });

    // 捕捉错误与警告
    player.on('error', function(event) {
      console.error("JW Player 播放错误：", event);
      alert("JW Player 播放错误：" + JSON.stringify(event));
    });
    player.on('adError', function(event) {
      console.error("广告错误：", event);
      alert("广告错误：" + JSON.stringify(event));
    });
    player.on('setupError', function(event) {
      console.error("配置错误：", event);
      alert("配置错误：" + JSON.stringify(event));
    });
    player.on('warning', function(event) {
      console.warn("警告：", event);
    });
  </script>
</body>
</html>
